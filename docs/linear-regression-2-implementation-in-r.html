<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>9 Linear Regression 2: Implementation in R | Lecture Note for Applied Econometrics</title>
  <meta name="description" content="9 Linear Regression 2: Implementation in R | Lecture Note for Applied Econometrics">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="9 Linear Regression 2: Implementation in R | Lecture Note for Applied Econometrics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Linear Regression 2: Implementation in R | Lecture Note for Applied Econometrics" />
  
  
  

<meta name="author" content="Yuta Toyama">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="linear-regression-1-theory.html">
<link rel="next" href="linear-regression-3-discussions-on-ols-assumptions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Econometrics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-this"><i class="fa fa-check"></i><b>1.1</b> About this</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#update-april-23-2019"><i class="fa fa-check"></i><b>1.2</b> Update: April 23, 2019</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#update-april-16-2019"><i class="fa fa-check"></i><b>1.3</b> Update: April 16, 2019</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#acknowledgement-as-of-april-16-2019"><i class="fa fa-check"></i><b>1.4</b> Acknowledgement (as of April 16, 2019)</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html"><i class="fa fa-check"></i><b>2</b> Introduction to the course</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#what-is-econometrics"><i class="fa fa-check"></i><b>2.1</b> What is econometrics?</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#why-do-we-need-to-learn-computation"><i class="fa fa-check"></i><b>2.2</b> Why do we need to learn computation</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#why-do-we-use-r"><i class="fa fa-check"></i><b>2.3</b> Why do we use R?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html"><i class="fa fa-check"></i><b>3</b> Introduction of <code>R</code> and <code>R studio</code></a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#getting-started"><i class="fa fa-check"></i><b>3.1</b> Getting Started</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#helps"><i class="fa fa-check"></i><b>3.2</b> Helps</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#quick-tour-of-rstudio"><i class="fa fa-check"></i><b>3.3</b> Quick tour of Rstudio</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#basic-calculations"><i class="fa fa-check"></i><b>3.4</b> Basic Calculations</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#getting-help"><i class="fa fa-check"></i><b>3.5</b> Getting Help</a></li>
<li class="chapter" data-level="3.6" data-path="introduction-of-r-and-r-studio.html"><a href="introduction-of-r-and-r-studio.html#installing-packages"><i class="fa fa-check"></i><b>3.6</b> Installing Packages</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-and-programming.html"><a href="data-and-programming.html"><i class="fa fa-check"></i><b>4</b> Data and Programming</a><ul>
<li class="chapter" data-level="4.1" data-path="data-and-programming.html"><a href="data-and-programming.html#data-types"><i class="fa fa-check"></i><b>4.1</b> Data Types</a></li>
<li class="chapter" data-level="4.2" data-path="data-and-programming.html"><a href="data-and-programming.html#data-structures"><i class="fa fa-check"></i><b>4.2</b> Data Structures</a></li>
<li class="chapter" data-level="4.3" data-path="data-and-programming.html"><a href="data-and-programming.html#vectors"><i class="fa fa-check"></i><b>4.3</b> Vectors</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-and-programming.html"><a href="data-and-programming.html#basics-of-vectors"><i class="fa fa-check"></i><b>4.3.1</b> Basics of vectors</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-and-programming.html"><a href="data-and-programming.html#useful-functions-for-creating-vectors"><i class="fa fa-check"></i><b>4.3.2</b> Useful functions for creating vectors</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-and-programming.html"><a href="data-and-programming.html#subsetting"><i class="fa fa-check"></i><b>4.3.3</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-and-programming.html"><a href="data-and-programming.html#vectorization"><i class="fa fa-check"></i><b>4.4</b> Vectorization</a></li>
<li class="chapter" data-level="4.5" data-path="data-and-programming.html"><a href="data-and-programming.html#logical-operators"><i class="fa fa-check"></i><b>4.5</b> Logical Operators</a></li>
<li class="chapter" data-level="4.6" data-path="data-and-programming.html"><a href="data-and-programming.html#matrices"><i class="fa fa-check"></i><b>4.6</b> Matrices</a><ul>
<li class="chapter" data-level="4.6.1" data-path="data-and-programming.html"><a href="data-and-programming.html#basics"><i class="fa fa-check"></i><b>4.6.1</b> Basics</a></li>
<li class="chapter" data-level="4.6.2" data-path="data-and-programming.html"><a href="data-and-programming.html#matrix-calculations"><i class="fa fa-check"></i><b>4.6.2</b> Matrix calculations</a></li>
<li class="chapter" data-level="4.6.3" data-path="data-and-programming.html"><a href="data-and-programming.html#getting-information-for-matrix"><i class="fa fa-check"></i><b>4.6.3</b> Getting information for matrix</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="data-and-programming.html"><a href="data-and-programming.html#lists"><i class="fa fa-check"></i><b>4.7</b> Lists</a></li>
<li class="chapter" data-level="4.8" data-path="data-and-programming.html"><a href="data-and-programming.html#data-frames"><i class="fa fa-check"></i><b>4.8</b> Data Frames</a></li>
<li class="chapter" data-level="4.9" data-path="data-and-programming.html"><a href="data-and-programming.html#programming-basics--control-flow-"><i class="fa fa-check"></i><b>4.9</b> Programming Basics -Control flow-</a><ul>
<li class="chapter" data-level="4.9.1" data-path="data-and-programming.html"><a href="data-and-programming.html#ifelse"><i class="fa fa-check"></i><b>4.9.1</b> if/else</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="data-and-programming.html"><a href="data-and-programming.html#for-loop"><i class="fa fa-check"></i><b>4.10</b> <code>for</code> loop</a></li>
<li class="chapter" data-level="4.11" data-path="data-and-programming.html"><a href="data-and-programming.html#functions"><i class="fa fa-check"></i><b>4.11</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-frame.html"><a href="data-frame.html"><i class="fa fa-check"></i><b>5</b> Data frame</a><ul>
<li class="chapter" data-level="5.1" data-path="data-frame.html"><a href="data-frame.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="data-frame.html"><a href="data-frame.html#load-csv-file"><i class="fa fa-check"></i><b>5.2</b> Load csv file</a></li>
<li class="chapter" data-level="5.3" data-path="data-frame.html"><a href="data-frame.html#examine-dataframe"><i class="fa fa-check"></i><b>5.3</b> Examine dataframe</a></li>
<li class="chapter" data-level="5.4" data-path="data-frame.html"><a href="data-frame.html#subsetting-data"><i class="fa fa-check"></i><b>5.4</b> Subsetting data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i><b>6</b> Exercise 1</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise-1.html"><a href="exercise-1.html#update-as-of-10am-april-18th"><i class="fa fa-check"></i><b>6.1</b> Update (as of 10am, April 18th)</a></li>
<li class="chapter" data-level="6.2" data-path="exercise-1.html"><a href="exercise-1.html#question-examine-the-law-of-large-numbers-through-numerical-simulations"><i class="fa fa-check"></i><b>6.2</b> Question: Examine the law of large numbers through numerical simulations</a><ul>
<li class="chapter" data-level="6.2.1" data-path="exercise-1.html"><a href="exercise-1.html#how-to-implement"><i class="fa fa-check"></i><b>6.2.1</b> How to implement</a></li>
<li class="chapter" data-level="6.2.2" data-path="exercise-1.html"><a href="exercise-1.html#what-to-submit"><i class="fa fa-check"></i><b>6.2.2</b> What to submit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html"><i class="fa fa-check"></i><b>7</b> A Review of Statistics</a><ul>
<li class="chapter" data-level="7.1" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#estimation"><i class="fa fa-check"></i><b>7.1</b> Estimation</a><ul>
<li class="chapter" data-level="7.1.1" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#properties-of-the-estimator"><i class="fa fa-check"></i><b>7.1.1</b> Properties of the estimator</a></li>
<li class="chapter" data-level="7.1.2" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#sample-mean-bary-is-unbiased-and-consistent"><i class="fa fa-check"></i><b>7.1.2</b> Sample mean <span class="math inline">\(\bar{Y}\)</span> is unbiased and consistent</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.2</b> Hypothesis Testing</a><ul>
<li class="chapter" data-level="7.2.1" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#central-limit-theorem"><i class="fa fa-check"></i><b>7.2.1</b> Central limit theorem</a></li>
<li class="chapter" data-level="7.2.2" data-path="a-review-of-statistics.html"><a href="a-review-of-statistics.html#hypothesis-testing-1"><i class="fa fa-check"></i><b>7.2.2</b> Hypothesis testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html"><i class="fa fa-check"></i><b>8</b> Linear Regression 1: Theory</a><ul>
<li class="chapter" data-level="8.1" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#regression-framework"><i class="fa fa-check"></i><b>8.1</b> Regression framework</a></li>
<li class="chapter" data-level="8.2" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#theoretical-properties-of-ols-estimator"><i class="fa fa-check"></i><b>8.2</b> Theoretical Properties of OLS estimator</a></li>
<li class="chapter" data-level="8.3" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#interpretation-and-specifications-of-linear-regression-model"><i class="fa fa-check"></i><b>8.3</b> Interpretation and Specifications of Linear Regression Model</a><ul>
<li class="chapter" data-level="8.3.1" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#nonlinear-term"><i class="fa fa-check"></i><b>8.3.1</b> Nonlinear term</a></li>
<li class="chapter" data-level="8.3.2" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#log-specification"><i class="fa fa-check"></i><b>8.3.2</b> log specification</a></li>
<li class="chapter" data-level="8.3.3" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#dummy-variable"><i class="fa fa-check"></i><b>8.3.3</b> Dummy variable</a></li>
<li class="chapter" data-level="8.3.4" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#interaction-term"><i class="fa fa-check"></i><b>8.3.4</b> Interaction term</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#measures-of-fit"><i class="fa fa-check"></i><b>8.4</b> Measures of Fit</a></li>
<li class="chapter" data-level="8.5" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#statistical-inference"><i class="fa fa-check"></i><b>8.5</b> Statistical Inference</a><ul>
<li class="chapter" data-level="8.5.1" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#distribution-of-the-ols-estimators-based-on-asymptotic-theory"><i class="fa fa-check"></i><b>8.5.1</b> Distribution of the OLS estimators based on asymptotic theory</a></li>
<li class="chapter" data-level="8.5.2" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#hypothesis-testing-2"><i class="fa fa-check"></i><b>8.5.2</b> Hypothesis testing</a></li>
<li class="chapter" data-level="8.5.3" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#confidence-interval"><i class="fa fa-check"></i><b>8.5.3</b> Confidence interval</a></li>
<li class="chapter" data-level="8.5.4" data-path="linear-regression-1-theory.html"><a href="linear-regression-1-theory.html#homoskedasticity-vs-heteroskedasticity"><i class="fa fa-check"></i><b>8.5.4</b> Homoskedasticity vs Heteroskedasticity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html"><i class="fa fa-check"></i><b>9</b> Linear Regression 2: Implementation in R</a><ul>
<li class="chapter" data-level="9.1" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html#implementation-in-r"><i class="fa fa-check"></i><b>9.1</b> Implementation in R</a><ul>
<li class="chapter" data-level="9.1.1" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html#preliminary-packages"><i class="fa fa-check"></i><b>9.1.1</b> Preliminary: packages</a></li>
<li class="chapter" data-level="9.1.2" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html#empirical-setting-data-from-california-school"><i class="fa fa-check"></i><b>9.1.2</b> Empirical setting: Data from California School</a></li>
<li class="chapter" data-level="9.1.3" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html#step-1-descriptive-analysis"><i class="fa fa-check"></i><b>9.1.3</b> Step 1: Descriptive analysis</a></li>
<li class="chapter" data-level="9.1.4" data-path="linear-regression-2-implementation-in-r.html"><a href="linear-regression-2-implementation-in-r.html#step-2-run-regression"><i class="fa fa-check"></i><b>9.1.4</b> Step 2: Run regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html"><i class="fa fa-check"></i><b>10</b> Linear Regression 3: Discussions on OLS Assumptions</a><ul>
<li class="chapter" data-level="10.1" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#introduction-1"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#endogeneity-problem"><i class="fa fa-check"></i><b>10.2</b> Endogeneity problem</a><ul>
<li class="chapter" data-level="10.2.1" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#omitted-variable-bias"><i class="fa fa-check"></i><b>10.2.1</b> Omitted variable bias</a></li>
<li class="chapter" data-level="10.2.2" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#correlation-v.s.-causality"><i class="fa fa-check"></i><b>10.2.2</b> Correlation v.s. Causality</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#multicollinearity-issue"><i class="fa fa-check"></i><b>10.3</b> Multicollinearity issue</a><ul>
<li class="chapter" data-level="10.3.1" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#perfect-multicollinearity"><i class="fa fa-check"></i><b>10.3.1</b> Perfect Multicollinearity</a></li>
<li class="chapter" data-level="10.3.2" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#imperfect-multicollinearity."><i class="fa fa-check"></i><b>10.3.2</b> Imperfect multicollinearity.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="linear-regression-3-discussions-on-ols-assumptions.html"><a href="linear-regression-3-discussions-on-ols-assumptions.html#lesson-for-an-empirical-analysis"><i class="fa fa-check"></i><b>10.4</b> Lesson for an empirical analysis</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html"><i class="fa fa-check"></i><b>11</b> Exercise 2 (Problem Set 3)</a><ul>
<li class="chapter" data-level="11.1" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html#rules"><i class="fa fa-check"></i><b>11.1</b> Rules</a></li>
<li class="chapter" data-level="11.2" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html#question-1-omitted-variable-bias"><i class="fa fa-check"></i><b>11.2</b> Question 1: Omitted Variable Bias</a></li>
<li class="chapter" data-level="11.3" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html#question-2-empirical-analysis-using-data-from-washington2008-aer"><i class="fa fa-check"></i><b>11.3</b> Question 2: Empirical Analysis using Data from Washington(2008, AER)</a><ul>
<li class="chapter" data-level="11.3.1" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html#preliminary-data-cleaning"><i class="fa fa-check"></i><b>11.3.1</b> Preliminary: data cleaning</a></li>
<li class="chapter" data-level="11.3.2" data-path="exercise-2-problem-set-3.html"><a href="exercise-2-problem-set-3.html#questions"><i class="fa fa-check"></i><b>11.3.2</b> Questions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html"><i class="fa fa-check"></i><b>12</b> Instrumental Variable 1: Framework</a><ul>
<li class="chapter" data-level="12.1" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#introduction-endogeneity-problem-and-its-solution"><i class="fa fa-check"></i><b>12.1</b> Introduction: Endogeneity Problem and its Solution</a></li>
<li class="chapter" data-level="12.2" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#examples-of-endogeneity-problem"><i class="fa fa-check"></i><b>12.2</b> Examples of Endogeneity Problem</a><ul>
<li class="chapter" data-level="12.2.1" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#more-on-omitted-variable-bias"><i class="fa fa-check"></i><b>12.2.1</b> More on Omitted Variable Bias</a></li>
<li class="chapter" data-level="12.2.2" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#measurement-error"><i class="fa fa-check"></i><b>12.2.2</b> Measurement error</a></li>
<li class="chapter" data-level="12.2.3" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#simultaneity-or-reverse-causality"><i class="fa fa-check"></i><b>12.2.3</b> Simultaneity (or reverse causality)</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#idea-of-iv-regression"><i class="fa fa-check"></i><b>12.3</b> Idea of IV Regression</a></li>
<li class="chapter" data-level="12.4" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#formal-framework-and-estimation"><i class="fa fa-check"></i><b>12.4</b> Formal Framework and Estimation</a><ul>
<li class="chapter" data-level="12.4.1" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#model"><i class="fa fa-check"></i><b>12.4.1</b> Model</a></li>
<li class="chapter" data-level="12.4.2" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#estimation-by-two-stage-least-squares-2sls"><i class="fa fa-check"></i><b>12.4.2</b> Estimation by Two Stage Least Squares (2SLS)</a></li>
<li class="chapter" data-level="12.4.3" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#conditions-for-valid-ivs-in-a-general-framework"><i class="fa fa-check"></i><b>12.4.3</b> Conditions for Valid IVs in a general framework</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#check-instrument-validity"><i class="fa fa-check"></i><b>12.5</b> Check Instrument Validity</a><ul>
<li class="chapter" data-level="12.5.1" data-path="instrumental-variable-1-framework.html"><a href="instrumental-variable-1-framework.html#relevance"><i class="fa fa-check"></i><b>12.5.1</b> Relevance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="instrumental-variable-2-implementation-in-r.html"><a href="instrumental-variable-2-implementation-in-r.html"><i class="fa fa-check"></i><b>13</b> Instrumental Variable 2: Implementation in R</a><ul>
<li class="chapter" data-level="13.1" data-path="instrumental-variable-2-implementation-in-r.html"><a href="instrumental-variable-2-implementation-in-r.html#example-1-wage-regression"><i class="fa fa-check"></i><b>13.1</b> Example 1: Wage regression</a><ul>
<li class="chapter" data-level="13.1.1" data-path="instrumental-variable-2-implementation-in-r.html"><a href="instrumental-variable-2-implementation-in-r.html#discussion-on-iv"><i class="fa fa-check"></i><b>13.1.1</b> Discussion on IV</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lecture Note for Applied Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression-2-implementation-in-r" class="section level1">
<h1><span class="header-section-number">9</span> Linear Regression 2: Implementation in R</h1>
<div id="implementation-in-r" class="section level2">
<h2><span class="header-section-number">9.1</span> Implementation in R</h2>
<div id="preliminary-packages" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Preliminary: packages</h3>
<ul>
<li>We use the following packages:
<ul>
<li><code>AER</code> :</li>
<li><code>dplyr</code> : data manipulation</li>
<li><code>stargazer</code> : output of regression results</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install package if you have not done so </span>
<span class="co"># install.packages(&quot;AER&quot;)</span>
<span class="co"># install.packages(&quot;dplyr&quot;)</span>
<span class="co"># install.packages(&quot;stargazer&quot;)</span>
<span class="co"># install.packages(&quot;lmtest&quot;)</span>

<span class="co"># load packages</span>
<span class="kw">library</span>(<span class="st">&quot;AER&quot;</span>)</code></pre></div>
<pre><code>##  要求されたパッケージ car をロード中です</code></pre>
<pre><code>##  要求されたパッケージ carData をロード中です</code></pre>
<pre><code>##  要求されたパッケージ lmtest をロード中です</code></pre>
<pre><code>##  要求されたパッケージ zoo をロード中です</code></pre>
<pre><code>## 
##  次のパッケージを付け加えます: &#39;zoo&#39;</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:base&#39; からマスクされています: 
## 
##      as.Date, as.Date.numeric</code></pre>
<pre><code>##  要求されたパッケージ sandwich をロード中です</code></pre>
<pre><code>##  要求されたパッケージ survival をロード中です</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre></div>
<pre><code>## 
##  次のパッケージを付け加えます: &#39;dplyr&#39;</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:car&#39; からマスクされています: 
## 
##      recode</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:stats&#39; からマスクされています: 
## 
##      filter, lag</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:base&#39; からマスクされています: 
## 
##      intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;stargazer&quot;</span>)</code></pre></div>
<pre><code>## 
## Please cite as:</code></pre>
<pre><code>##  Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.</code></pre>
<pre><code>##  R package version 5.2.2. https://CRAN.R-project.org/package=stargazer</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;lmtest&quot;</span>)</code></pre></div>
</div>
<div id="empirical-setting-data-from-california-school" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Empirical setting: Data from California School</h3>
<ul>
<li>Question: How does the student-teacher ratio affects test scores?</li>
<li>We use data from California school, which is included in <code>AER</code> package.
<ul>
<li>See here for the details: <a href="https://www.rdocumentation.org/packages/AER/versions/1.2-6/topics/CASchools" class="uri">https://www.rdocumentation.org/packages/AER/versions/1.2-6/topics/CASchools</a></li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load the the data set in the workspace</span>
<span class="kw">data</span>(CASchools)</code></pre></div>
<ul>
<li>Use <code>class()</code> function to see <code>CASchools</code> is <code>data.frame</code> object.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(CASchools)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<ul>
<li>We take 2 steps for the analysis.
<ul>
<li>Step 1: Look at data (descriptive analysis)</li>
<li>Step 2: Run regression</li>
</ul></li>
</ul>
</div>
<div id="step-1-descriptive-analysis" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Step 1: Descriptive analysis</h3>
<ul>
<li>It is always important to grasp your data before running regression.</li>
<li><code>head()</code> function give you a first overview of the data.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(CASchools)</code></pre></div>
<pre><code>##   district                          school  county grades students
## 1    75119              Sunol Glen Unified Alameda  KK-08      195
## 2    61499            Manzanita Elementary   Butte  KK-08      240
## 3    61549     Thermalito Union Elementary   Butte  KK-08     1550
## 4    61457 Golden Feather Union Elementary   Butte  KK-08      243
## 5    61523        Palermo Union Elementary   Butte  KK-08     1335
## 6    62042         Burrel Union Elementary  Fresno  KK-08      137
##   teachers calworks   lunch computer expenditure    income   english  read
## 1    10.90   0.5102  2.0408       67    6384.911 22.690001  0.000000 691.6
## 2    11.15  15.4167 47.9167      101    5099.381  9.824000  4.583333 660.5
## 3    82.90  55.0323 76.3226      169    5501.955  8.978000 30.000002 636.3
## 4    14.00  36.4754 77.0492       85    7101.831  8.978000  0.000000 651.9
## 5    71.50  33.1086 78.4270      171    5235.988  9.080333 13.857677 641.8
## 6     6.40  12.3188 86.9565       25    5580.147 10.415000 12.408759 605.7
##    math
## 1 690.0
## 2 661.9
## 3 650.9
## 4 643.5
## 5 639.9
## 6 605.4</code></pre>
<ul>
<li>Alternatively, you can use <code>browse()</code> to see the entire dataset in browser window.</li>
</ul>
<div id="create-variables" class="section level4">
<h4><span class="header-section-number">9.1.3.1</span> Create variables</h4>
<ul>
<li>Create several variables that are needed for the analysis.</li>
<li>We use <code>dplyr</code> for this purpose.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CASchools <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">STR =</span> students <span class="op">/</span><span class="st"> </span>teachers ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>( <span class="dt">score =</span> (read <span class="op">+</span><span class="st"> </span>math) <span class="op">/</span><span class="st"> </span><span class="dv">2</span> ) -&gt;<span class="st"> </span>CASchools </code></pre></div>
</div>
<div id="descriptive-statistics" class="section level4">
<h4><span class="header-section-number">9.1.3.2</span> Descriptive statistics</h4>
<ul>
<li>There are several ways to show descriptive statistics</li>
<li>The standard one is to use <code>summary()</code> function</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(CASchools)</code></pre></div>
<pre><code>##    district            school                  county      grades   
##  Length:420         Length:420         Sonoma     : 29   KK-06: 61  
##  Class :character   Class :character   Kern       : 27   KK-08:359  
##  Mode  :character   Mode  :character   Los Angeles: 27              
##                                        Tulare     : 24              
##                                        San Diego  : 21              
##                                        Santa Clara: 20              
##                                        (Other)    :272              
##     students          teachers          calworks          lunch       
##  Min.   :   81.0   Min.   :   4.85   Min.   : 0.000   Min.   :  0.00  
##  1st Qu.:  379.0   1st Qu.:  19.66   1st Qu.: 4.395   1st Qu.: 23.28  
##  Median :  950.5   Median :  48.56   Median :10.520   Median : 41.75  
##  Mean   : 2628.8   Mean   : 129.07   Mean   :13.246   Mean   : 44.71  
##  3rd Qu.: 3008.0   3rd Qu.: 146.35   3rd Qu.:18.981   3rd Qu.: 66.86  
##  Max.   :27176.0   Max.   :1429.00   Max.   :78.994   Max.   :100.00  
##                                                                       
##     computer       expenditure       income          english      
##  Min.   :   0.0   Min.   :3926   Min.   : 5.335   Min.   : 0.000  
##  1st Qu.:  46.0   1st Qu.:4906   1st Qu.:10.639   1st Qu.: 1.941  
##  Median : 117.5   Median :5215   Median :13.728   Median : 8.778  
##  Mean   : 303.4   Mean   :5312   Mean   :15.317   Mean   :15.768  
##  3rd Qu.: 375.2   3rd Qu.:5601   3rd Qu.:17.629   3rd Qu.:22.970  
##  Max.   :3324.0   Max.   :7712   Max.   :55.328   Max.   :85.540  
##                                                                   
##       read            math            STR            score      
##  Min.   :604.5   Min.   :605.4   Min.   :14.00   Min.   :605.5  
##  1st Qu.:640.4   1st Qu.:639.4   1st Qu.:18.58   1st Qu.:640.0  
##  Median :655.8   Median :652.5   Median :19.72   Median :654.5  
##  Mean   :655.0   Mean   :653.3   Mean   :19.64   Mean   :654.2  
##  3rd Qu.:668.7   3rd Qu.:665.9   3rd Qu.:20.87   3rd Qu.:666.7  
##  Max.   :704.0   Max.   :709.5   Max.   :25.80   Max.   :706.8  
## </code></pre>
<ul>
<li>This returns the desriptive statistics for all the variables in dataframe.</li>
<li>You can combine this with <code>dplyr::select</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CASchools <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(STR, score) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>()</code></pre></div>
<pre><code>##       STR            score      
##  Min.   :14.00   Min.   :605.5  
##  1st Qu.:18.58   1st Qu.:640.0  
##  Median :19.72   Median :654.5  
##  Mean   :19.64   Mean   :654.2  
##  3rd Qu.:20.87   3rd Qu.:666.7  
##  Max.   :25.80   Max.   :706.8</code></pre>
<ul>
<li>You can do a bit lengthly thing manually like this.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute sample averages of STR and score</span>
avg_STR &lt;-<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>STR) 
avg_score &lt;-<span class="st"> </span><span class="kw">mean</span>(CASchools<span class="op">$</span>score)

<span class="co"># compute sample standard deviations of STR and score</span>
sd_STR &lt;-<span class="st"> </span><span class="kw">sd</span>(CASchools<span class="op">$</span>STR) 
sd_score &lt;-<span class="st"> </span><span class="kw">sd</span>(CASchools<span class="op">$</span>score)

<span class="co"># set up a vector of percentiles and compute the quantiles </span>
quantiles &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>)
quant_STR &lt;-<span class="st"> </span><span class="kw">quantile</span>(CASchools<span class="op">$</span>STR, quantiles)
quant_score &lt;-<span class="st"> </span><span class="kw">quantile</span>(CASchools<span class="op">$</span>score, quantiles)

<span class="co"># gather everything in a data.frame </span>
DistributionSummary &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Average =</span> <span class="kw">c</span>(avg_STR, avg_score), 
                                  <span class="dt">StandardDeviation =</span> <span class="kw">c</span>(sd_STR, sd_score), 
                                  <span class="dt">quantile =</span> <span class="kw">rbind</span>(quant_STR, quant_score))

<span class="co"># print the summary to the console</span>
DistributionSummary</code></pre></div>
<pre><code>##               Average StandardDeviation quantile.10. quantile.25.
## quant_STR    19.64043          1.891812      17.3486     18.58236
## quant_score 654.15655         19.053347     630.3950    640.05000
##             quantile.40. quantile.50. quantile.60. quantile.75.
## quant_STR       19.26618     19.72321      20.0783     20.87181
## quant_score    649.06999    654.45000     659.4000    666.66249
##             quantile.90.
## quant_STR       21.86741
## quant_score    678.85999</code></pre>
<ul>
<li>My personal favorite is to use <code>stargazer</code> function.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stargazer</span>(CASchools, <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>)</code></pre></div>
<pre><code>## 
## ===========================================================================
## Statistic    N    Mean    St. Dev.     Min    Pctl(25)  Pctl(75)     Max   
## ---------------------------------------------------------------------------
## students    420 2,628.793 3,913.105    81        379      3,008    27,176  
## teachers    420  129.067   187.913    4.850    19.662    146.350  1,429.000
## calworks    420  13.246    11.455     0.000     4.395    18.981    78.994  
## lunch       420  44.705    27.123     0.000    23.282    66.865    100.000 
## computer    420  303.383   441.341      0        46       375.2     3,324  
## expenditure 420 5,312.408  633.937  3,926.070 4,906.180 5,601.401 7,711.507
## income      420  15.317     7.226     5.335    10.639    17.629    55.328  
## english     420  15.768    18.286       0        1.9      23.0       86    
## read        420  654.970   20.108    604.500   640.400   668.725   704.000 
## math        420  653.343   18.754      605      639.4     665.8      710   
## STR         420  19.640     1.892    14.000    18.582    20.872    25.800  
## score       420  654.157   19.053    605.550   640.050   666.662   706.750 
## ---------------------------------------------------------------------------</code></pre>
<ul>
<li>You can choose summary statistics you want to report.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CASchools <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stargazer</span>( <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">summary.stat =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;p75&quot;</span>, <span class="st">&quot;sd&quot;</span>) ) </code></pre></div>
<pre><code>## 
## ===================================
## Statistic    N  Pctl(75)  St. Dev. 
## -----------------------------------
## students    420   3,008   3,913.105
## teachers    420  146.350   187.913 
## calworks    420  18.981    11.455  
## lunch       420  66.865    27.123  
## computer    420   375.2    441.341 
## expenditure 420 5,601.401  633.937 
## income      420  17.629     7.226  
## english     420   23.0     18.286  
## read        420  668.725   20.108  
## math        420   665.8    18.754  
## STR         420  20.872     1.892  
## score       420  666.662   19.053  
## -----------------------------------</code></pre>
<ul>
<li>See <a href="https://www.jakeruss.com/cheatsheets/stargazer/#the-default-summary-statistics-table" class="uri">https://www.jakeruss.com/cheatsheets/stargazer/#the-default-summary-statistics-table</a> for the details.</li>
<li>We will use <code>stargazer</code> to report regression results.</li>
</ul>
</div>
<div id="scatter-plot" class="section level4">
<h4><span class="header-section-number">9.1.3.3</span> Scatter plot</h4>
<ul>
<li>Let’s see how test score and student-teacher-ratio is correlated.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(score <span class="op">~</span><span class="st"> </span>STR, 
     <span class="dt">data =</span> CASchools,
     <span class="dt">main =</span> <span class="st">&quot;Scatterplot of TestScore and STR&quot;</span>, 
     <span class="dt">xlab =</span> <span class="st">&quot;STR (X)&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Test Score (Y)&quot;</span>)</code></pre></div>
<p><img src="07_Regression2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<ul>
<li>Use <code>cor()</code> to compute the correlation between two numeric vectors.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(CASchools<span class="op">$</span>STR, CASchools<span class="op">$</span>score)</code></pre></div>
<pre><code>## [1] -0.2263627</code></pre>
</div>
</div>
<div id="step-2-run-regression" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Step 2: Run regression</h3>
<div id="simple-linear-regression" class="section level4">
<h4><span class="header-section-number">9.1.4.1</span> Simple linear regression</h4>
<ul>
<li>We use <code>lm()</code> function to run linear regression</li>
<li>First, consider the simple linear regression <span class="math display">\[
score_i = \beta_0 + \beta_1 size_i + \epsilon_i
\]</span> where <span class="math inline">\(size_i\)</span> is the class size (student-teacher-ratio).
<ul>
<li>From now on we call student-teacher-ratio (STR) class size.</li>
</ul></li>
<li>To run this regression, we use <code>lm</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First, we rename the variable `STR`</span>
CASchools <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>( <span class="dt">size =</span> STR) -&gt;<span class="st"> </span>CASchools

<span class="co"># Run regression and save results in the varaiable `model1_summary`</span>
model1_summary &lt;-<span class="st"> </span><span class="kw">lm</span>( score <span class="op">~</span><span class="st"> </span>size, <span class="dt">data =</span> CASchools)

<span class="co"># See the results</span>
<span class="kw">summary</span>(model1_summary)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = score ~ size, data = CASchools)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -47.727 -14.251   0.483  12.822  48.540 
## 
## Coefficients:
##             Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept) 698.9329     9.4675  73.825 &lt; 0.0000000000000002 ***
## size         -2.2798     0.4798  -4.751           0.00000278 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 18.58 on 418 degrees of freedom
## Multiple R-squared:  0.05124,    Adjusted R-squared:  0.04897 
## F-statistic: 22.58 on 1 and 418 DF,  p-value: 0.000002783</code></pre>
<ul>
<li>Interpretations
<ul>
<li>An increase of one student per teacher leads to 2.2 point decrease in test scores.</li>
<li>p value is very small. The effect of the class size on test score is significant. Note: Be careful. These standard errors are NOT heteroskedasiticity robust. We will come back to this point soon.</li>
<li><span class="math inline">\(R^2 = 0.051\)</span>, implying that 5.1% of the variance of the dependent variable is explained by the model.</li>
</ul></li>
<li>You can add more variable in the regression (will see this soon)</li>
</ul>
</div>
<div id="correction-of-robust-standard-error" class="section level4">
<h4><span class="header-section-number">9.1.4.2</span> Correction of Robust standard error</h4>
<ul>
<li>We use <code>vcovHC()</code> function, a partof the package <code>sandwich</code>, to obtain the robust standard errors.
<ul>
<li>The package <code>sandwich</code> is automatically loaded if you load <code>AER</code> package.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute heteroskedasticity-robust standard errors</span>
vcov &lt;-<span class="st"> </span><span class="kw">vcovHC</span>(model1_summary, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>)

<span class="co"># get standard error: the square root of the diagonal element in vcov</span>
robust_se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">diag</span>(vcov))
robust_se</code></pre></div>
<pre><code>## (Intercept)        size 
##  10.3643617   0.5194893</code></pre>
<ul>
<li>Notice that robust standard errors are larger than the one we obtained from <code>lm</code>!</li>
<li>How to combine the robust standard errors with the original summary? Use <code>coeftest()</code> from the package <code>lmtest</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load `lmtest`</span>
<span class="kw">library</span>(lmtest)

<span class="co"># Combine robust standard errors</span>
<span class="kw">coeftest</span>(model1_summary, <span class="dt">vcov. =</span> vcov)</code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##              Estimate Std. Error t value              Pr(&gt;|t|)    
## (Intercept) 698.93295   10.36436 67.4362 &lt; 0.00000000000000022 ***
## size         -2.27981    0.51949 -4.3886            0.00001447 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="report-by-stargazer" class="section level4">
<h4><span class="header-section-number">9.1.4.3</span> Report by Stargazer</h4>
<ul>
<li><code>stargazer</code> is useful to show the regression result.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load</span>
<span class="kw">library</span>(stargazer)

<span class="co"># Create output by stargazer</span>
stargazer<span class="op">::</span><span class="kw">stargazer</span>(model1_summary, <span class="dt">type =</span><span class="st">&quot;text&quot;</span>)</code></pre></div>
<pre><code>## 
## ===============================================
##                         Dependent variable:    
##                     ---------------------------
##                                score           
## -----------------------------------------------
## size                         -2.280***         
##                               (0.480)          
##                                                
## Constant                    698.933***         
##                               (9.467)          
##                                                
## -----------------------------------------------
## Observations                    420            
## R2                             0.051           
## Adjusted R2                    0.049           
## Residual Std. Error      18.581 (df = 418)     
## F Statistic           22.575*** (df = 1; 418)  
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<ul>
<li>Use robust standard errors in stargazer output</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Prepare robust standard errors in list</span>
rob_se &lt;-<span class="st"> </span><span class="kw">list</span>( <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(model1_summary, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>) ) ) ) 

<span class="co"># generate regression table. </span>

<span class="kw">stargazer</span>( model1_summary, 
           <span class="dt">se =</span> rob_se, 
           <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>)</code></pre></div>
<pre><code>## 
## ===============================================
##                         Dependent variable:    
##                     ---------------------------
##                                score           
## -----------------------------------------------
## size                         -2.280***         
##                               (0.519)          
##                                                
## Constant                    698.933***         
##                              (10.364)          
##                                                
## -----------------------------------------------
## Observations                    420            
## R2                             0.051           
## Adjusted R2                    0.049           
## Residual Std. Error      18.581 (df = 418)     
## F Statistic           22.575*** (df = 1; 418)  
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div id="full-results" class="section level4">
<h4><span class="header-section-number">9.1.4.4</span> Full results</h4>
<p>Taken from <a href="https://www.econometrics-with-r.org/7-6-analysis-of-the-test-score-data-set.html" class="uri">https://www.econometrics-with-r.org/7-6-analysis-of-the-test-score-data-set.html</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load the stargazer library</span>

<span class="co"># estimate different model specifications</span>
spec1 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size, <span class="dt">data =</span> CASchools)
spec2 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english, <span class="dt">data =</span> CASchools)
spec3 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>lunch, <span class="dt">data =</span> CASchools)
spec4 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>calworks, <span class="dt">data =</span> CASchools)
spec5 &lt;-<span class="st"> </span><span class="kw">lm</span>(score <span class="op">~</span><span class="st"> </span>size <span class="op">+</span><span class="st"> </span>english <span class="op">+</span><span class="st"> </span>lunch <span class="op">+</span><span class="st"> </span>calworks, <span class="dt">data =</span> CASchools)

<span class="co"># gather robust standard errors in a listh</span>
rob_se &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(spec1, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(spec2, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(spec3, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(spec4, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))),
               <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcovHC</span>(spec5, <span class="dt">type =</span> <span class="st">&quot;HC1&quot;</span>))))

<span class="co"># generate a LaTeX table using stargazer</span>
<span class="kw">stargazer</span>(spec1, spec2, spec3, spec4, spec5,
          <span class="dt">se =</span> rob_se,
          <span class="dt">digits =</span> <span class="dv">3</span>,
          <span class="dt">header =</span> F,
          <span class="dt">column.labels =</span> <span class="kw">c</span>(<span class="st">&quot;(I)&quot;</span>, <span class="st">&quot;(II)&quot;</span>, <span class="st">&quot;(III)&quot;</span>, <span class="st">&quot;(IV)&quot;</span>, <span class="st">&quot;(V)&quot;</span>),
          <span class="dt">type =</span><span class="st">&quot;text&quot;</span>, 
          <span class="dt">keep.stat =</span> <span class="kw">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;adj.rsq&quot;</span>))</code></pre></div>
<pre><code>## 
## ===================================================================
##                               Dependent variable:                  
##              ------------------------------------------------------
##                                      score                         
##                 (I)        (II)      (III)       (IV)       (V)    
##                 (1)        (2)        (3)        (4)        (5)    
## -------------------------------------------------------------------
## size         -2.280***   -1.101**  -0.998***  -1.308***  -1.014*** 
##               (0.519)    (0.433)    (0.270)    (0.339)    (0.269)  
##                                                                    
## english                 -0.650***  -0.122***  -0.488***  -0.130*** 
##                          (0.031)    (0.033)    (0.030)    (0.036)  
##                                                                    
## lunch                              -0.547***             -0.529*** 
##                                     (0.024)               (0.038)  
##                                                                    
## calworks                                      -0.790***    -0.048  
##                                                (0.068)    (0.059)  
##                                                                    
## Constant     698.933*** 686.032*** 700.150*** 697.999*** 700.392***
##               (10.364)   (8.728)    (5.568)    (6.920)    (5.537)  
##                                                                    
## -------------------------------------------------------------------
## Observations    420        420        420        420        420    
## Adjusted R2    0.049      0.424      0.773      0.626      0.773   
## ===================================================================
## Note:                                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<ul>
<li>The coefficient on the class size decreases as we add more explantory variables. Can you explain why? (Hint: omitted variable bias)</li>
</ul>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regression-1-theory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression-3-discussions-on-ols-assumptions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["Econometrics_using_R.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
